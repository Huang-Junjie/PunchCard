# PunchCard

## 选题背景

### 背景

所谓“一日之计在于晨”，保持早起习惯不仅对工作学习有帮助，还有利于自身的身体健
康。但现实生活中很多人都有“起床困难症”，缺乏形成良好习惯的好办法及毅力。市面上的
打卡软件要么是缺乏奖励惩罚机制，效果甚微；要么可能存在一定的信用问题，比如公布虚
假的打卡人数，私吞部分奖金；要么可能会收取一定比例的手续费。

### 优势

* 智能合约构造的打卡项目，通过缴纳一定的以太币，拥有着一定的惩罚和奖励机制。
* 可以自行调整投入的金额，选择适合自己的激励程度。
* 奖罚严格按照合约代码执行，无任何欺骗现象，保证参与的公正性。
* 除了小部分的 gas 费用，没有任何的中间人收取费用，保障了参与者的利益。

## 构思

首先某个发起者在星期天早上7 点（假设早起目标是7点）创建该合约。之后的星期一到星期天每天早上5点到7点间是打卡时间。到下个星期天早上7点后本周打卡项目截止，可以进行结算，并开启下一周的打卡项目。该合约可以每周重复运行，无需管理。具体如下：

1. 某个发起者在星期天早上7 点（假设早起目标是7点）创建该合约。
2. 在当天（星期天） 24 点前，任何人可以加入该项目，同时向该合约账户转入一笔金额（最高为10 ether），作为本周加入打卡项目的权重。
3. 每天早上5点到7点是打卡时间，不在打卡时间内无法打卡。
4. 每次打卡返回以太币 （加入金额 / 7）。
5. 在星期天早上7点后，本周打卡项目结束，可以进行结算：
   * 因为有人某几天早上没有打卡，因此合约账户会有余额；
   * 任何人可以调用合约的结算函数；
   * 调用合约结算函数的人可以获得合约账户余额的10%的以太币作为奖励和对gas的补偿；
   * 合约结算函数将合约余额剩余的90%按加入打卡项目的权重分给成功连续7天打卡的人；
   * 合约结算函数同时会开启下一周的打卡项目，并重置本周合约变量。



## 成果展示（测试）：

因为PunchCard打卡项目是以天为单位的，因此重写了一个测试合约，将时间判断进行修改：

* 项目开启后2分钟为加入时间（模拟星期天打卡项目开启后，在星期天晚上12点前为加入时间）；
* 加入时间结束后，每1分钟模拟经过一天；
* 1分钟的前30秒可以打卡，模拟每天的早上打卡时间；
* 7个1分钟后（模拟一周后）可以结算开启下一轮打卡项目。



1. 开启本地geth: 

``geth --identity "TestNode" --rpc --rpcport "8545" --datadir data --port "30303" --rpccorsdomain "*" --nodiscover console - -rpcapi web3,eth,net,personal``

2. 打开test.html
3. 初始界面

![1546246491142](C:\Users\huangjj\AppData\Roaming\Typora\typora-user-images\1546246491142.png)

4. 选取一个账户，输入密码登入：账户列表会从本地geth里读取，如果没有，可以点击register进行注册，注册后的账户信息会保存在geth的keystore目录中。

![1546246872421](C:\Users\huangjj\AppData\Roaming\Typora\typora-user-images\1546246872421.png)

![1546247043009](C:\Users\huangjj\AppData\Roaming\Typora\typora-user-images\1546247043009.png)

5. 部署测试合约：点击部署合约按钮进行部署，得到合约地址。为了可以多浏览器可以同时运行该合约，可以将合约地址赋值到test.js中![1546247208033](C:\Users\huangjj\AppData\Roaming\Typora\typora-user-images\1546247208033.png)。

   也可以一开始就使用remix部署合约，将合约地址赋值给test.js的contractAddr变量。

![1546247109087](C:\Users\huangjj\AppData\Roaming\Typora\typora-user-images\1546247109087.png)

6. 进行测试：假设3个账户加入本周打卡计划，加入金额为分别为1 ether，2 ether，3 ether。账户1完成7天打卡，账户2执行结算函数（在本周打卡项目结束后点击开启按钮）。

![1546247656816](C:\Users\huangjj\AppData\Roaming\Typora\typora-user-images\1546247656816.png)![1546247641288](C:\Users\huangjj\AppData\Roaming\Typora\typora-user-images\1546247641288.png)

6. 

