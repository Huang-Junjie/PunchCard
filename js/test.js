if (typeof web3 !== 'undefined') {
  web3 = new Web3(web3.currentProvider);
} else {
  web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
}

var account;
var password;
var punchcardtestContract;
var punchcardtest;
// var contractAddr;
var contractAddr = '0x533658d7fd0Fe8FE3cb026d90E7C5984A42e5928'; //将合约换为部署地址

$(function() {
	init();
 	$('#login').click(loginEvent);
 	$('#register').click(registerEvent);
 	$('#loginButton').click(loginButtonEvent);
 	$('#quit').click(quitEvent);
 	$('#deployButton').click(deployButtonEvent);
 	$('#joinButton').click(joinButtonEvent);
 	$('#punchButton').click(punchButtonEvent);
 	$('#resetButton').click(resetButtonEvent);
});

function init() {
	getAccount();
	if (contractAddr) {
		punchcardtest = new web3.eth.Contract([{"constant":true,"inputs":[],"name":"sumOfMoneyOfpunched","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"succeedAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"participators","outputs":[{"name":"beginTime","type":"uint256"},{"name":"money","type":"uint256"},{"name":"punchTimes","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"week","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"punchIn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"beginTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"ifBegin","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"join","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"achievers","outputs":[{"name":"addr","type":"address"},{"name":"money","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"reset","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}], contractAddr);
		console.log(punchcardtest);
	}
}

function getAccount() {
	// var accounts = web3.eth.accounts;
	// for (var i = 0; i < accounts.length; i++) { 
	// 	$('#accounts').append('<option value=' + accounts[i] + '/>');
	// }
	web3.eth.getAccounts().then(e => {
		for (var i = 0; i < e.length; i++) { 
			$('#accounts').append('<option value=' + e[i] + '/>');
		}
	});
}

function loginEvent() {
	$('#loginBox').css('display', 'block');
	$('#registerBox').css('display', 'none');
	$('#login').removeClass('unselected');
	$('#register').addClass('unselected');
	$('.inputError').css('display', 'none');
}

function registerEvent() {
	$('#loginBox').css('display', 'none');
	$('#registerBox').css('display', 'block');
	$('#login').addClass('unselected');
	$('#register').removeClass('unselected');
	$('.inputError').css('display', 'none');
}

function loginButtonEvent() {
	account = $('#accountInput').val();
	password = $('#passwordInput').val();
	// try {
	// 	web3.personal.unlockAccount(account, password);
	// 	$('#beginBox').css('display', 'none');
	// 	$('#punchCard').css('display', 'block');
	// 	getInfo();
	// } catch(err) {
	// 	$('.inputError').css('display', 'block');
	// 	console.log(err);
	// }
	$('#beginBox').css('display', 'none');
	$('#punchCard').css('display', 'block');
	getInfo();
	// web3.eth.personal.unlockAccount(account, password)
	// .then(() => {
	// 	$('#beginBox').css('display', 'none');
	// 	$('#punchCard').css('display', 'block');
	// 	getInfo();
	// })
	// .catch((err) =>{
	// 	$('.inputError').css('display', 'block');
	// 	console.log(err);
	// });
}

function quitEvent() {
	$('#beginBox').css('display', 'block');
	$('#punchCard').css('display', 'none');
}

// function getBalance() {
// 	web3.eth.getBalance(account)
// 	.then((balance) => {$('#balance').text(balance);});
// 	// try {
// 	// 	var balance = web3.eth.getBalance(account);
// 	// 	$('#balance').text(balance);
// 	// } catch(err) {
// 	// 	console.log(err);
// 	// }
// }

function deployButtonEvent() {
	// var punchcardtestContract = web3.eth.contract([{"constant":true,"inputs":[],"name":"sumOfMoneyOfpunched","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"succeedAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"participators","outputs":[{"name":"beginTime","type":"uint256"},{"name":"money","type":"uint256"},{"name":"punchTimes","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"week","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"punchIn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"beginTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"ifBegin","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"join","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"achievers","outputs":[{"name":"addr","type":"address"},{"name":"money","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"reset","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);
	// var punchcardtest = punchcardtestContract.new(
	//    {
	//      from: web3.eth.accounts[0], 
	//      data: '0x60806040526000600355600060045534801561001a57600080fd5b5042600081905550610ee2806100316000396000f3006080604052600436106100a4576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806325993370146100a95780632d38bacf146100d45780633a372c94146100ff5780634995b458146101645780636ca7f2fe1461018f57806388149fb9146101a6578063aa351149146101d1578063b688a36314610200578063d2e5cff01461020a578063d826f88f1461027e575b600080fd5b3480156100b557600080fd5b506100be610295565b6040518082815260200191505060405180910390f35b3480156100e057600080fd5b506100e961029b565b6040518082815260200191505060405180910390f35b34801561010b57600080fd5b50610140600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506102a1565b60405180848152602001838152602001828152602001935050505060405180910390f35b34801561017057600080fd5b506101796102cb565b6040518082815260200191505060405180910390f35b34801561019b57600080fd5b506101a46102d1565b005b3480156101b257600080fd5b506101bb610884565b6040518082815260200191505060405180910390f35b3480156101dd57600080fd5b506101e661088a565b604051808215151515815260200191505060405180910390f35b61020861089c565b005b34801561021657600080fd5b5061023560048036038101908080359060200190929190505050610b13565b604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390f35b34801561028a57600080fd5b50610293610b66565b005b60045481565b60035481565b60016020528060005260406000206000915090508060000154908060010154908060020154905083565b60055481565b600a601e603c6000544203038115156102e657fe5b0610151561035c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe5b7b2e99499e8bf87e4bb8ae697a5e68993e58da1e697b6e997b4000000000081525060200191505060405180910390fd5b60d2603c6000544203031015156103db576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe69cace8bdaee68993e58da1e9a1b9e79baee5b7b2e7bb93e69d9f000000000081525060200191505060405180910390fd5b600054600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141515610496576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe69caae58aa0e585a5e69cace591a8e68993e58da1e9a1b9e79bae000000000081525060200191505060405180910390fd5b601e603c6000544203038115156104a957fe5b04600581905550600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060030160055460078110151561050157fe5b602091828204019190069054906101000a900460ff1615151561058c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600d8152602001807fe9878de5a48de68993e58da12e0000000000000000000000000000000000000081525060200191505060405180910390fd5b60018060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206003016005546007811015156105de57fe5b602091828204019190066101000a81548160ff021916908315150217905550600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201600081548092919060010191905055503373ffffffffffffffffffffffffffffffffffffffff166108fc6007600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101548115156106b757fe5b049081150290604051600060405180830381858888f193505050501580156106e3573d6000803e3d6000fd5b506007600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020154141561088257600360008154809291906001019190505550600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010154600460008282540192505081905550600260408051908101604052803373ffffffffffffffffffffffffffffffffffffffff168152602001600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101548152509080600181540180825580915050906001820390600052602060002090600202016000909192909190915060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101555050505b565b60005481565b600060d2603c60005442030310905090565b6000603c6000540142101515610940576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260278152602001807fe5b7b2e99499e8bf87e69cace8bdaee68993e58da1e9a1b9e79baee58aa0e58581526020017fa5e697b6e997b40000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b600054600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141515156109fc576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe5b7b2e58aa0e585a5e69cace591a8e68993e58da1e9a1b9e79bae000000000081525060200191505060405180910390fd5b678ac7230489e800003410610a1957678ac7230489e80000610a1b565b345b905060806040519081016040528060005481526020018281526020016000815260200160e060405190810160405280600015151515815260200160001515151581526020016000151515158152602001600015151515815260200160001515151581526020016000151515158152602001600015151515815250815250600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082015181600001556020820151816001015560408201518160020155606082015181600301906007610b0c929190610d6d565b5090505050565b600281815481101515610b2257fe5b90600052602060002090600202016000915090508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060010154905082565b60008060d2603c600054420303111515610be8576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe69cace8bdaee68993e58da1e9a1b9e79baee69caae7bb93e69d9f000000000081525060200191505060405180910390fd5b3073ffffffffffffffffffffffffffffffffffffffff163191503373ffffffffffffffffffffffffffffffffffffffff166108fc600a84811515610c2857fe5b049081150290604051600060405180830381858888f19350505050158015610c54573d6000803e3d6000fd5b50600a82811515610c6157fe5b0482039150600090505b600354811015610d3857600281815481101515610c8457fe5b906000526020600020906002020160000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc60045484600285815481101515610ce257fe5b90600052602060002090600202016001015402811515610cfe57fe5b049081150290604051600060405180830381858888f19350505050158015610d2a573d6000803e3d6000fd5b508080600101915050610c6b565b6000600281610d479190610e06565b506000600381905550600060048190555061010e60008082825401925050819055505050565b826007601f01602090048101928215610df55791602002820160005b83821115610dc657835183826101000a81548160ff0219169083151502179055509260200192600101602081600001049283019260010302610d89565b8015610df35782816101000a81549060ff0219169055600101602081600001049283019260010302610dc6565b505b509050610e029190610e38565b5090565b815481835581811115610e3357600202816002028360005260206000209182019101610e329190610e68565b5b505050565b610e6591905b80821115610e6157600081816101000a81549060ff021916905550600101610e3e565b5090565b90565b610eb391905b80821115610eaf57600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055600182016000905550600201610e6e565b5090565b905600a165627a7a72305820032d0faf02505b7d220027c94828335eb4165385ae53faebe7dd63b54ceadf4b0029', 
	//      gas: '4700000'
	//    }, function (e, contract){
	//     console.log(e, contract);
	//     if (typeof contract.address !== 'undefined') {
	//          console.log('Contract mined! address: ' + contract.address + ' transactionHash: ' + contract.transactionHash);
	//     }
	//  });
	// web3.eth.personal.unlockAccount(account, password);
	punchcardtestContract = new web3.eth.Contract([{"constant":true,"inputs":[],"name":"sumOfMoneyOfpunched","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"succeedAmount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"participators","outputs":[{"name":"beginTime","type":"uint256"},{"name":"money","type":"uint256"},{"name":"punchTimes","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"week","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"punchIn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"beginTime","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"ifBegin","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"join","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"achievers","outputs":[{"name":"addr","type":"address"},{"name":"money","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"reset","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);
	punchcardtestContract.deploy({
	    data: '0x60806040526000600355600060045534801561001a57600080fd5b5042600081905550610ee2806100316000396000f3006080604052600436106100a4576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806325993370146100a95780632d38bacf146100d45780633a372c94146100ff5780634995b458146101645780636ca7f2fe1461018f57806388149fb9146101a6578063aa351149146101d1578063b688a36314610200578063d2e5cff01461020a578063d826f88f1461027e575b600080fd5b3480156100b557600080fd5b506100be610295565b6040518082815260200191505060405180910390f35b3480156100e057600080fd5b506100e961029b565b6040518082815260200191505060405180910390f35b34801561010b57600080fd5b50610140600480360381019080803573ffffffffffffffffffffffffffffffffffffffff1690602001909291905050506102a1565b60405180848152602001838152602001828152602001935050505060405180910390f35b34801561017057600080fd5b506101796102cb565b6040518082815260200191505060405180910390f35b34801561019b57600080fd5b506101a46102d1565b005b3480156101b257600080fd5b506101bb610884565b6040518082815260200191505060405180910390f35b3480156101dd57600080fd5b506101e661088a565b604051808215151515815260200191505060405180910390f35b61020861089c565b005b34801561021657600080fd5b5061023560048036038101908080359060200190929190505050610b13565b604051808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018281526020019250505060405180910390f35b34801561028a57600080fd5b50610293610b66565b005b60045481565b60035481565b60016020528060005260406000206000915090508060000154908060010154908060020154905083565b60055481565b600a601e603c6000544203038115156102e657fe5b0610151561035c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe5b7b2e99499e8bf87e4bb8ae697a5e68993e58da1e697b6e997b4000000000081525060200191505060405180910390fd5b60d2603c6000544203031015156103db576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe69cace8bdaee68993e58da1e9a1b9e79baee5b7b2e7bb93e69d9f000000000081525060200191505060405180910390fd5b600054600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141515610496576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe69caae58aa0e585a5e69cace591a8e68993e58da1e9a1b9e79bae000000000081525060200191505060405180910390fd5b601e603c6000544203038115156104a957fe5b04600581905550600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060030160055460078110151561050157fe5b602091828204019190069054906101000a900460ff1615151561058c576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252600d8152602001807fe9878de5a48de68993e58da12e0000000000000000000000000000000000000081525060200191505060405180910390fd5b60018060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206003016005546007811015156105de57fe5b602091828204019190066101000a81548160ff021916908315150217905550600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600201600081548092919060010191905055503373ffffffffffffffffffffffffffffffffffffffff166108fc6007600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101548115156106b757fe5b049081150290604051600060405180830381858888f193505050501580156106e3573d6000803e3d6000fd5b506007600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060020154141561088257600360008154809291906001019190505550600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010154600460008282540192505081905550600260408051908101604052803373ffffffffffffffffffffffffffffffffffffffff168152602001600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600101548152509080600181540180825580915050906001820390600052602060002090600202016000909192909190915060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550602082015181600101555050505b565b60005481565b600060d2603c60005442030310905090565b6000603c6000540142101515610940576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260278152602001807fe5b7b2e99499e8bf87e69cace8bdaee68993e58da1e9a1b9e79baee58aa0e58581526020017fa5e697b6e997b40000000000000000000000000000000000000000000000000081525060400191505060405180910390fd5b600054600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000154141515156109fc576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe5b7b2e58aa0e585a5e69cace591a8e68993e58da1e9a1b9e79bae000000000081525060200191505060405180910390fd5b678ac7230489e800003410610a1957678ac7230489e80000610a1b565b345b905060806040519081016040528060005481526020018281526020016000815260200160e060405190810160405280600015151515815260200160001515151581526020016000151515158152602001600015151515815260200160001515151581526020016000151515158152602001600015151515815250815250600160003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600082015181600001556020820151816001015560408201518160020155606082015181600301906007610b0c929190610d6d565b5090505050565b600281815481101515610b2257fe5b90600052602060002090600202016000915090508060000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16908060010154905082565b60008060d2603c600054420303111515610be8576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807fe69cace8bdaee68993e58da1e9a1b9e79baee69caae7bb93e69d9f000000000081525060200191505060405180910390fd5b3073ffffffffffffffffffffffffffffffffffffffff163191503373ffffffffffffffffffffffffffffffffffffffff166108fc600a84811515610c2857fe5b049081150290604051600060405180830381858888f19350505050158015610c54573d6000803e3d6000fd5b50600a82811515610c6157fe5b0482039150600090505b600354811015610d3857600281815481101515610c8457fe5b906000526020600020906002020160000160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc60045484600285815481101515610ce257fe5b90600052602060002090600202016001015402811515610cfe57fe5b049081150290604051600060405180830381858888f19350505050158015610d2a573d6000803e3d6000fd5b508080600101915050610c6b565b6000600281610d479190610e06565b506000600381905550600060048190555061010e60008082825401925050819055505050565b826007601f01602090048101928215610df55791602002820160005b83821115610dc657835183826101000a81548160ff0219169083151502179055509260200192600101602081600001049283019260010302610d89565b8015610df35782816101000a81549060ff0219169055600101602081600001049283019260010302610dc6565b505b509050610e029190610e38565b5090565b815481835581811115610e3357600202816002028360005260206000209182019101610e329190610e68565b5b505050565b610e6591905b80821115610e6157600081816101000a81549060ff021916905550600101610e3e565b5090565b90565b610eb391905b80821115610eaf57600080820160006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055600182016000905550600201610e6e565b5090565b905600a165627a7a72305820032d0faf02505b7d220027c94828335eb4165385ae53faebe7dd63b54ceadf4b0029', 
	})
	.send({
	    from: account,
	    gas: 4700000
	})
	.then((newContractInstance) => {
		console.log(newContractInstance);
		punchcardtest = newContractInstance;
	    
	    getInfo();
	});
	alert("正在部署，等待挖坑");
}

function getInfo() {
	$("#addr").text(punchcardtest.options.address);
	
	web3.eth.getBalance(account)
	.then((balance) => {
		$('#balance').text(web3.utils.fromWei(balance, 'ether'));});

	if (punchcardtest) {
		punchcardtest.methods.ifBegin().call({from:account})
		.then((result) => {
	    	if (result) {
	    		$("#ifItemOpen").text("是");
	    	}
	    	else {
	    		$("#ifItemOpen").text("否");
	    	}
		});

		punchcardtest.methods.participators(account).call({from:account})
		.then((result) => {
	    	console.log(result);
	    	punchcardtest.methods.beginTime().call({from:account})
	    	.then((time) => {
	    		// console.log(typeof result);
	    		// console.log(result);
	    		// console.log(typeof time);
	    		// console.log(time);
	    		if (result.beginTime == time) {
		    		$("#ifJoined").text("是");
		    		$("#joinMoney").text(web3.utils.fromWei(result.money, 'ether'));
		    	}
		    	else {
		    		$("#ifJoined").text("否");
		    		$("#joinMoney").text(0);
		    	}
	    	})	
		});
	}
}

function joinButtonEvent() {
	try{
		var money = web3.utils.toWei($('#joinInput').val(), 'ether');
		// web3.eth.personal.unlockAccount(account, password);
		punchcardtest.methods.join().send({from:account, value:money, gas:3000000})
		.then((result) => {console.log(result);})
		.catch((err) => {alert(err);});
		alert("正在参与，等待挖坑");

	} catch(err) {
		alert(err);
	}
}	

function punchButtonEvent() {
	console.log(punchcardtest);
	console.log(punchcardtest);
}

function resetButtonEvent() {

}